# VariableSetting プラグイン開発計画（改訂版）

## プロジェクト概要

**プラグイン名**: VariableSetting  
**目的**: shadcn/ui準拠したバリアブルをワンクリックで自動生成し、デザイナーの作業効率を劇的に向上
**主な機能**: プライマリカラー選択のみでの完全なデザインシステム変数生成、5つのコレクション構造対応  
**アプローチ**: シンプルさを維持しながら設計仕様に完全準拠  
**対象ユーザー**: UI/UXデザイナー、特にshadcn/uiを使用する開発チームと協業するデザイナー

## タスク分析

- **目的**: Figmaバリアブル設定の簡便性を維持しながら、figma-variable-design.mdの設計仕様に完全準拠し、SOLID原則に基づくコード改善を行う
- **技術要件**: バニラJavaScript、HTML、CSS（フレームワーク不使用）、Figma Plugin API
- **実装手順**: 段階的なリファクタリングと機能拡張
- **リスク**: 設計仕様との不整合、過度の抽象化によるシンプルさの損失
- **品質基準**: コード可読性、保守性、直感的なUI、設計仕様との完全な整合性

## 開発フェーズ

### フェーズ1: コード構造の整理（2週間）

#### 1-1: ファイル分割と基本リファクタリング 🔄

- **目標**: HTML/CSS/JSの適切な分離と基本的なモジュール構造の確立
- **作業内容**:
  - ui.htmlからHTMLマークアップのみを抽出して`index.html`に移行 🔄
  - インラインCSSをスタイルシートファイル`styles/main.css`に分離 🔄
  - JavaScriptを機能別に`scripts/`ディレクトリに分割 🔄
    - `main.js`: エントリーポイントと初期化 🔄
    - `ui-handler.js`: UI操作関連 🔄
    - `variable-service.js`: 変数生成関連 🔄
    - `figma-bridge.js`: Figma通信関連 🔄
    - `utils.js`: ユーティリティ関数 🔄

```markdown
```plaintext
src/
├── ui/
│   ├── index.html
│   ├── styles/
│   │   └── main.css
│   └── scripts/
│       ├── main.js
│       ├── ui-handler.js
│       ├── variable-service.js
│       ├── figma-bridge.js
│       └── utils.js
```

#### 1-2: 関心の分離 🔄

- **目標**: 単一責任原則(SRP)に基づくコード整理
- **作業内容**:
  - グローバル変数・関数の削減 🔄
  - 機能ごとのモジュールパターン導入 🔄
  - イベントハンドラの整理とイベント委譲の活用 🔄
  - コードの役割分担の明確化 🔄

### フェーズ2: デザイン仕様対応（3週間）

#### 2-1: 5つのコレクション構造対応 🔄

- **目標**: figma-variable-design.mdに定義された5つのコレクション構造を完全実装
- **作業内容**:
  - コレクション管理クラスの作成 🔄
  - 各コレクションタイプの初期化と管理機能 🔄
  - コレクション間の階層関係の実装 🔄
  - 変数命名規則の適用 🔄

```javascript
// collections.js
const COLLECTION_TYPES = {
  PRIMITIVE: 'primitive',
  COMPONENT: 'component',
  CORE: 'core',
  UTILITY: 'utility',
  SEMANTIC: 'semantic'
};

class CollectionManager {
  constructor() {
    this.collections = {};
    // 各コレクションの初期化と関係性の設定
  }
  
  // コレクション管理メソッド
}
```

#### 2-2: 変数構造の拡張 🔄

- **目標**: 設計仕様に従った変数階層とモード対応の実装
- **作業内容**:
  - 階層型変数命名の実装と検証 🔄
  - ライト/ダークモード対応 🔄
  - 変数間参照の実装 🔄
  - 変数の依存関係管理 🔄

#### 2-3: UIの拡張と改善 🔄

- **目標**: 現在のシンプルさを維持しながら、5つのコレクション構造をサポートするUI
- **作業内容**:
  - **シンプルなトグル設定の追加**
    - デフォルトですべてのコレクションが有効（ユーザーは何も選択せずに使用可能）
    - 必要に応じて特定のコレクションをオプションで無効化できる設定を「詳細設定」セクションに追加
    - 折りたたみ可能なパネルとして実装し、初期状態では非表示に
  - **カラー選択フォーカスの維持**
    - 現在の直感的なカラーピッカーを中心としたUIを維持
    - プレビューパレットの視認性向上
    - カラーコード入力のバリデーション強化
  - **ワンクリック生成の維持と強化**
    - 「バリアブル生成」ボタンの視認性と使いやすさの向上
    - 処理中の視覚的フィードバックの改善
    - 成功時の明確な完了通知
  - **アクセシビリティ改善**
    - キーボード操作のサポート強化
    - スクリーンリーダー対応の改善
    - コントラスト比の最適化

### フェーズ3: 品質向上（2週間）

#### 3-1: エラーハンドリングの強化 🔄

- **目標**: 堅牢なエラー処理と明確なユーザーフィードバック
- **作業内容**:
  - 一貫したエラーハンドリングパターンの実装
  - ユーザーフレンドリーなエラーメッセージ
  - 処理状態の視覚的フィードバック
  - ロギング機能の改善

#### 3-2: テストとドキュメンテーション 🔄

- **目標**: コードの信頼性とメンテナンス性の向上
- **作業内容**:
  - 主要機能の単体テスト作成
  - インラインドキュメントの充実
  - 使用方法ガイドの更新
  - コーディング規約の適用

### フェーズ4: 最適化と完成（1週間）

#### 4-1: パフォーマンス最適化 🔄

- **目標**: 処理速度と応答性の向上
- **作業内容**:
  - 不要なDOM操作の削減
  - イベントハンドラの最適化
  - メモリ使用量の改善
  - レンダリングパフォーマンスの向上

#### 4-2: 最終調整と品質検証 🔄

- **目標**: 最終的な品質確保と完成
- **作業内容**:
  - 全機能の総合テスト
  - エッジケースの検証
  - ユーザーフィードバックの反映
  - 最終ドキュメント更新

## 設計方針

### SOLID原則の適用

1. **単一責任原則 (SRP)**
   - 各ファイル・モジュールは明確に定義された一つの責任を持つ
   - 例: UI操作、変数生成、Figma通信の分離

2. **開放閉鎖原則 (OCP)**
   - 拡張可能なコレクション管理システム
   - 設定オブジェクトを通じた拡張性確保

3. **リスコフの置換原則 (LSP)**
   - 一貫した変数操作インターフェースの実装
   - 型安全性の確保

4. **インターフェース分離原則 (ISP)**
   - 最小限で特化したインターフェースの提供
   - 責任の明確な分離

5. **依存性逆転原則 (DIP)**
   - 抽象化を通じた依存関係の管理
   - テスト容易性の向上

### コーディング規約

1. 各ファイルは最大200行に制限
2. 明確な命名規則の適用
3. 適切なコメントとドキュメンテーション
4. エラーハンドリングの一貫性
5. パフォーマンスへの配慮

## シンプルさの維持

1. **直感的なUI**
   - 最小限のクリックでバリアブル設定が完了する設計
   - 視覚的にわかりやすいフィードバック
   - 段階的な操作フロー

2. **コード可読性**
   - 過度な抽象化を避けたシンプルな実装
   - 明確な関数名と変数名
   - 適切なコメントと文書化

3. **保守性**
   - モジュール間の依存関係の最小化
   - 一貫したエラーハンドリング
   - テスト可能な設計

## マイルストーン

1. **v0.1**: 開発環境セットアップと基盤構築 🔄
2. **v0.2**: 基本的なカラーパレット生成 🔄
3. **v0.3**: 変数コレクションとLight/Darkモード 🔄
4. **v0.4**: 5つのコレクション構造完全対応 🔄
5. **v0.5**: エラーハンドリング強化とテスト導入 🔄
6. **v1.0**: 完全な機能セットと安定版リリース 🔄

## 貢献ガイドライン

- コミットメッセージは [Conventional Commits](https://www.conventionalcommits.org/) に従う
- PRを作成する前にローカルでテストを実行
- コードはESLintとPrettierのルールに準拠
- 新機能には対応するテストを追加

## 使用技術詳細

- **言語**: TypeScript
- **UI**: HTML/CSS（フレームワーク不使用）
- **ビルドツール**: Vite
- **パッケージマネージャー**: pnpm
- **テスト**: Vitest
- **CI/CD**: GitHub Actions
- **コード品質**: ESLint + Prettier
- **バージョン管理**: Git + GitHub

最終更新: 2025年3月15日
