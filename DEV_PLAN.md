# VariableSetting プラグイン開発計画（改訂版）

## プロジェクト概要

**プラグイン名**: VariableSetting  
**目的**: shadcn/ui準拠したFigmaバリアブルをワンクリックで自動生成し、デザイナーの作業効率を劇的に向上させる  
**主な機能**: プライマリカラー選択のみでの完全なデザインシステム変数生成、5つのコレクション構造対応  
**アプローチ**: シンプルさを維持しながら設計仕様に完全準拠  
**対象ユーザー**: UI/UXデザイナー、特にshadcn/uiを使用する開発チームと協業するデザイナー

## タスク分析

- **目的**: Figmaバリアブル設定の簡便性を維持しながら、figma-variable-design.mdの設計仕様に完全準拠し、SOLID原則に基づくコード改善を行う
- **技術要件**: TypeScript、HTML、CSS（フレームワーク不使用）、Figma Plugin API
- **実装手順**: 段階的なリファクタリングと機能拡張
- **リスク**: 設計仕様との不整合、過度の抽象化によるシンプルさの損失
- **品質基準**: コード可読性、保守性、直感的なUI、設計仕様との完全な整合性

## 開発フェーズ

### フェーズ1: コード構造の整理（2週間）

#### 1-1: SOLID原則に基づく基本リファクタリング

- **目標**: コードベースをSOLID原則に従った構造に再編成
- **作業内容**:
  - 各サービスクラスの単一責任原則（SRP）の徹底
  - インターフェース定義と依存性逆転原則（DIP）の適用
  - クラス間の適切な継承関係の確立（LSP）
  - 型エラーの解消と型安全性の確保
  - コード分割と適切なモジュール化

#### 1-2: ファイル構造の最適化

- **目標**: 責任範囲を明確にしたファイル構成
- **作業内容**:
  - サービス層の明確な分離
  - UI関連コードとロジックの分離
  - 共通ユーティリティの整理
  - 型定義の集約と整理
  - 各ファイルを最大200行に制限

```plaintext
src/
├── code.ts                   # エントリーポイント
├── ui.html                   # UI定義
├── services/                 # サービスレイヤー
│   ├── MessageHandlerService.ts  # メッセージ処理
│   ├── FigmaService.ts       # Figma API操作
│   └── designSystem/         # デザインシステム関連
│       ├── BaseVariableService.ts      # 基底変数サービス
│       ├── PrimitiveVariableService.ts # プリミティブ変数サービス
│       ├── ThemeVariableService.ts     # テーマ変数サービス
│       ├── ResponsiveVariableService.ts # レスポンシブ変数サービス
│       ├── ComponentVariableService.ts  # コンポーネント変数サービス
│       └── ComponentResponsiveVariableService.ts # レスポンシブコンポーネント変数サービス
├── types/                    # 型定義
│   ├── figma.d.ts            # Figma API型定義
│   ├── messageTypes.ts       # メッセージ型定義
│   └── variableTypes.ts      # 変数関連型定義
└── utils/                    # ユーティリティ
    ├── colorUtils.ts         # 色操作ユーティリティ
    └── validationUtils.ts    # 検証ユーティリティ
```

### フェーズ2: 変数設計の実装（3週間）

#### 2-1: 正確なコレクション構造の実装

- **目標**: figma-variable-design.mdに準拠した5つのコレクション構造を完全実装
- **作業内容**:
  - 指定された名称でのコレクション実装：
    1. **Primitives**（基本値）- モードなし
    2. **Theme**（テーマ関連の値）- light/darkモード
    3. **Responsive**（レスポンシブ関連の値）- mobile/tablet/desktopモード
    4. **Component**（テーマ関連のコンポーネント値）- light/darkモード
    5. **Component-Responsive**（レスポンシブ関連のコンポーネント値）- mobile/tablet/desktopモード
  - 各コレクション用のサービスクラスの実装
  - コレクション間の正確な参照関係の確立

#### 2-2: 変数構造の詳細実装

- **目標**: 仕様書に従った詳細な変数構造の完全実装
- **作業内容**:
  - **Primitivesコレクション**:
    - color（slate, gray, zinc, neutral, stone, red, blue, green等）
    - size（0, 1, 2, 3, 4, 5, 6, 8, 10, 12, 16等）
    - radius（none, sm, md, lg, xl, 2xl, 3xl, full）
    - font（family, size, weight, line-height）
    - shadow（none, sm, md, lg, xl, 2xl）
    - animation（duration, easing）
  - **Themeコレクション**:
    - background, foreground, card, card-foreground等
    - ライト/ダークモードの値設定
    - Primitivesからの正確な参照
  - **Responsiveコレクション**:
    - spacing, font-size, breakpoint等
    - モバイル/タブレット/デスクトップ対応
  - **Componentコレクション**:
    - button, card, input等のコンポーネント変数
    - Themeからの参照関係の維持
  - **Component-Responsiveコレクション**:
    - レスポンシブ対応のコンポーネント変数
    - Responsiveからの参照

#### 2-3: 変数参照システムの実装

- **目標**: コレクション間の参照関係を正確にサポートするシステム
- **作業内容**:
  - 変数間参照の管理機能
  - 循環参照の検出と防止
  - 参照の整合性チェック
  - 変数更新時の参照更新

### フェーズ3: UIの改善（2週間）

#### 3-1: シンプルさを維持したUI拡張

- **目標**: 5つのコレクション構造をサポートしつつ直感的なUI
- **作業内容**:
  - プライマリカラー選択中心の現在のUIを保持
  - 詳細設定セクションの追加（折りたたみ可能）
  - コレクション単位での有効/無効切り替え機能
  - カラーパレットのプレビュー強化
  - 変数生成プロセスの視覚的フィードバック改善

#### 3-2: アクセシビリティとUX改善

- **目標**: 全てのユーザーが効率的に利用できるUI
- **作業内容**:
  - キーボード操作のサポート強化
  - スクリーンリーダー対応
  - コントラスト比の最適化
  - エラーメッセージの明確化
  - ヘルプとツールチップの追加

### フェーズ4: 品質向上（2週間）

#### 4-1: エラーハンドリングの強化

- **目標**: 堅牢なエラー処理と明確なユーザーフィードバック
- **作業内容**:
  - 詳細なエラーログシステム
  - ユーザーフレンドリーなエラー表示
  - 自動リカバリーとフォールバック機能
  - エラー状況の分析機能

#### 4-2: テストと最適化

- **目標**: 品質と性能の保証
- **作業内容**:
  - 単体テストの作成
  - 統合テストの実装
  - パフォーマンス最適化
  - メモリ使用量の削減

### フェーズ5: 完成と文書化（1週間）

#### 5-1: 最終調整

- **目標**: 完成度の高いプラグインの実現
- **作業内容**:
  - 最終的なエッジケーステスト
  - ユーザーからのフィードバック対応
  - 微調整と洗練

#### 5-2: ドキュメンテーション

- **目標**: プラグインの使い方と内部構造の文書化
- **作業内容**:
  - 使用方法ガイドの作成
  - 設計文書の更新
  - インラインコメントの充実
  - バージョン履歴の管理

## SOLID原則の適用

1. **単一責任原則 (SRP)**
   - 各サービスクラスは1つの責任のみを持つ
   - 例：PrimitiveVariableServiceはプリミティブ変数の管理のみに特化

2. **開放閉鎖原則 (OCP)**
   - 機能拡張に開き、修正に閉じた設計
   - 例：新しい変数タイプを追加時に既存コードを変更せず拡張可能な構造

3. **リスコフの置換原則 (LSP)**
   - 派生クラスは基底クラスと互換性を持つ
   - 例：各VariableServiceは基底IVariableServiceのインターフェースを完全実装

4. **インターフェース分離原則 (ISP)**
   - 特化したインターフェースの使用
   - 例：変数サービスごとに必要なメソッドのみを定義したインターフェース

5. **依存性逆転原則 (DIP)**
   - 高レベルモジュールは低レベルモジュールに依存しない
   - 例：具体的な実装ではなくインターフェースに依存する設計

## 開発基準

1. **コード品質**
   - 各ファイルは最大200行まで
   - TypeScriptの厳格な型チェック
   - ESLintとPrettierによるコード整形
   - 明確なコメントと文書化

2. **テスト戦略**
   - 単体テスト（Jest）
   - 統合テスト
   - 手動テスト手順の明確化

3. **パフォーマンス目標**
   - 1000個の変数生成を5秒以内に完了
   - メモリ使用量の最適化
   - 応答性の高いUI

## プロジェクトスケジュール

| フェーズ | 期間 | 開始日 | 完了予定日 |
|----------|------|--------|------------|
| フェーズ1: コード構造の整理 | 2週間 | 2025-03-16 | 2025-03-30 |
| フェーズ2: 変数設計の実装 | 3週間 | 2025-03-31 | 2025-04-20 |
| フェーズ3: UIの改善 | 2週間 | 2025-04-21 | 2025-05-04 |
| フェーズ4: 品質向上 | 2週間 | 2025-05-05 | 2025-05-18 |
| フェーズ5: 完成と文書化 | 1週間 | 2025-05-19 | 2025-05-25 |

## 最後に

この開発計画は、figma-variable-design.mdに完全に準拠した設計を実現し、SOLID原則に基づいた高品質なコードを目指すものです。シンプルさと機能性のバランスを取りながら、デザイナーの効率を最大化する使いやすいプラグインを開発します。

最終更新: 2025年3月15日
